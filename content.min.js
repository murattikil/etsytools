function init(){var a=window.location.pathname.split("/")[1];("your"==a||"developers"==a)&&($("#et-bar").attr("style","display:none"),$("body").attr("style","margin-top: 0px")),userid=$("html").data("user-id"),userid&&(userid=userid.toString(),ask(),timer())}function ask(){chrome.runtime.sendMessage({userid:userid},function(a){update_counters(a)})}function update_counters(a){window.hearted=parseInt(a.hearted),$("#et-hearted").text(parseInt(a.hearted)),$("#et-unhearted").text(parseInt(a.unhearted))}function timer(){var a=new Date,b=60-a.getUTCMinutes();ask(),$("#et-hearts-timer").text(b),setTimeout(timer,1e3)}function txt(a){$("p#reply-paragraph").children("textarea").text(a+note),$("input#new-post-submit").simulateClick("click")}function favAll(){hearted>300?(sessionStorage.favathone=0,$("#et-status-list").attr("style","background:#F49D92").prepend("<li>The limit of 300 hearts is reached. Please, wait until next hour and press the button again.</li>")):$(".thread").length?favA():($("#listing-wrapper").length||$(".treasury-view").length)&&favB()}function favA(){var a=setInterval(function(){if($(".thread .favorited-button").each(function(){$(this).simulateClick("click")}),0==$(".thread .favorited-button").length){clearInterval(a);var b=setInterval(function(){$(".thread .button-fave").not(".favorited-button").each(function(){$(this).simulateClick("click")}),$(".thread .button-fave").not(".favorited-button").length||(clearInterval(b),$("#pager-wrapper .next").length?(sessionStorage.favathone=1,$("a.next").simulateClick("click")):(sessionStorage.favathone=0,$("#et-status-list").attr("style","background:#92F496").prepend("<li>Finished! Please, don't forget to check few pages, just in case if you were out of hearts.</li>")))},1e3)}},1e3)}function favB(){var a=setInterval(function(){if($(".listings .listing-card .btn-fave.done").each(function(){$(this).simulateClick("click")}),0==$(".listings .listing-card .btn-fave.done").length){clearInterval(a);var b=setInterval(function(){$(".listings .listing-card .btn-fave").not(".done").each(function(){$(this).simulateClick("click")}),$(".listings .listing-card .btn-fave").not(".done").length||(clearInterval(b),$("#pager-wrapper .next").length?(sessionStorage.favathone=1,$("a.next").simulateClick("click")):(sessionStorage.favathone=0,$("#et-status-list").attr("style","background:#92F496").prepend("<li>Finished! Please, don't forget to check few pages, just in case if you were out of hearts.</li>")))},1e3)}},1e3)}function clickAll(){for(var a=window.location.protocol,b=$('.forum-post .body a[href*="/listing/"]:visible, .forum-post .listing-title a[href*="/listing/"]:visible'),c=0;c<b.length;c++){var d=$(b[c]).attr("href").replace(/http[s]?:/,a);openLink(d,!0)}var e=$("#pager-wrapper .next");e.length?openLink(e.attr("href"),!1):$("#et-status-list").attr("style","background:#92F496").prepend("<li>Congratulations!!! We are done!</li>")}function openLink(a,b){"undefined"==typeof b&&(b=!1);var c=document.createElement("a");c.href=a;var d=document.createEvent("MouseEvents");d.initMouseEvent("click",!0,!0,window,0,0,0,0,0,b,!1,!1,b,0,null),c.dispatchEvent(d)}var css=document.createElement("LINK"),hearted,userid,bar,buttons,counter,reply,note,ad;if(css.rel="stylesheet",css.href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css",document.getElementsByTagName("HEAD")[0].appendChild(css),bar='<div id="et-bar" class="etsytools-bar"><div id="et-bar-container">',bar+='<div id="et-counter"></div>',bar+='<div id="et-status-bar"><ul id="et-status-list"></ul></div>',bar+='<div id="et-menu"></div>',bar+="</div></div>",buttons='<button id="fav-all" class="fa fa-heart" title="unFav/Fav all products"> unFav/Fav</button>',buttons+='<button id="click-all" class="fa fa-external-link" title="Click all listings"> ClickAll</button>',counter='<span id="et-hearts-timer" title="Minutes left until next hour">0</span>',counter+='<span id="hearts-container">',counter+='<i class="hearts fa fa-heart hearted"> </i><span id="et-hearted" title="Hearted this hour">0</span>',counter+='<i class="hearts fa fa-heart-o"> </i><span id="et-unhearted" title="Unhearted this hour">0</span>',counter+="</span>",reply='<button id="et-here-btn">here</button>',reply+='<button id="et-done-btn">done</button>',reply+='<br><button id="et-outhearts-btn">out of hearts</button>',note="\n\n\u2764\u2764\u2764\u2764\u2764\u2764\u2764\u2764\u2764\u2764\u2764\u2764",note+="\nI am using EtsyTools",note+="\nIt's quick. It's easy to use. It's free!",note+="\nhttp://etsytools.reatlat.net/",ad=["Simplicity is the ultimate sophistication. - Leonardo da Vinci",'Please share "<a href="http://etsytools.reatlat.net/" target="_blank">EtsyTools</a>"" for friends','Do you like "<a href="http://etsytools.reatlat.net/" target="_blank">EtsyTools</a>"? Please leave <a href="https://chrome.google.com/webstore/detail/etsytools/cmmikdmpeopfconfkmdnoffbplecnjae/reviews" target="_blank">review</a> =)'],$("body").prepend(bar),$("#et-counter").prepend(counter),$("#et-menu").append(buttons),$("div#right").children("div.panel.clear").children("a#reply-box-button").before(reply),$("#et-status-list").prepend("<li>"+ad[Math.floor(Math.random()*ad.length)]+"</li>"),$("#pager-wrapper").length){var page=$("#pager-wrapper .current-page").text()||$("#pager-wrapper .active a").text(),pages=$("#pager-wrapper .page_num:last").text()||$("#pager-wrapper li:last a").text();$("#et-status-list").prepend("<li>page "+page+" of "+pages+"</li>")}$("#et-here-btn").click(function(){txt("here")}),$("#et-done-btn").click(function(){txt("done")}),$("#et-outhearts-btn").click(function(){txt("out of hearts | page "+page)}),$("#fav-all").click(function(){favAll()}),$("#click-all").click(function(){clickAll()}),chrome.runtime.onMessage.addListener(function(a,b,c){update_counters(a)}),jQuery.fn.simulateClick=function(){return this.each(function(){if("createEvent"in document){var a=this.ownerDocument,b=a.createEvent("MouseEvents");b.initMouseEvent("click",!0,!0,a.defaultView,1,0,0,0,0,!1,!1,!1,!1,0,null),this.dispatchEvent(b)}else this.click()})},init(),1==sessionStorage.favathone&&favAll();